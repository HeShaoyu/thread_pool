# 提纲
## 课程主要内容
- 计算机网络和互联网
- 应用层
- 传输层
- 网络层：数据平
- 网络层：控制平面
- 数据链路层和局域网
- 网络安全
- 无线和移动网络
- 多媒体网络
- 网络管理
# 第一章：概论
## 1.1什么是Internet
### 1.1.1 节点：
- 主机及其上运行的应用程序
- 路由器、交换机等网络交换设备
### 1.1.2 边：
- 接入网链路，主机连接到互联网的链路
- 主干链路，路由器间的链路

支撑互联网工作的标准
数以亿计的、互联的计算设备：
- 主机 = 端系统
- 运行网络网络应用程序

通信链路
- 光纤、同轴电缆、无线电、卫星
- 传输速率 = 带宽（bps）

分组交换设备：转发分组（packets）
- 路由器和交换机
### 1.1.3 协议
协议控制发送、接收消息
- 如TCP、IP、HTTP、FTP、PPP

Internet：“网络的网络”
- 松散的层次结构、互联的ISP
- 公共Internet vs 专用internet

Internet标准
- RFC：Request for comments
- IETF：Internet Engineering Task Force 所有协议，以RFC格式发到IETF上，让全球工程师进行评审。群策群力构建互联网发展
### 1.1.4 人类协议
- 几点啦？
- 我有个问题
- 你好
### 1.1.5 网络协议
- 类似人类协议
- 机器之间的协议而非人与人之间的协议
- Internet中所有的通信行为都受协议制约
### 1.1.6 定义
协议定义了在两个或多个通信实体之间交换的报文格式和次序，以及在报文传输和/或接收或其他事件方面所采取的动作
### 1.1.7 使用通信设施进行通信的分布式应用
- web、VoIp、email、分布式游戏、电子商务、社交网络......
### 1.1.8 通信基础设施为apps提供编程接口（通信服务）
- 将发送和接收数据的apps与互联网连接起来
- 为app应用提供服务选择，类似于邮政服务：
-- 无连接不可靠服务 UDP
-- 面向连接的可靠服务 TCP/IP

## 1.2 网络边缘
主机
应用程序（客户端和服务端）

端系统（主机）：
运行应用程序，如Web、email在“网络的边缘”

客户端/服务器模式：
客户端向服务器请求、接收服务，如Web浏览器/服务器：email客户端/服务器

对等（peer-peer）模式：
很少（甚至没有）专门的服务器，如迅雷

### 1.2.1 采用网络设施的面向连接服务
目标：在端系统之间传输数据
- 握手：在数据传输之前做好准备
  人类协议中：你好，你好
  两个通信主机之间为连接建立状态
- TCP - 传输控制协议 （Transmission Control Protocol）
  Internet上面向连接的服务

TCP服务
- 可靠的、按顺序地传送数据
  确认和重传
- 流量控制
  发送方不会淹没接收方
- 拥塞控制
  当网络拥塞时，发送方降低发送速率
### 1.2.2 采用基础设施的无连接服务
目标：在端系统之间传输数据
- 无连接服务
- UDP - 用户数据报协议（User Datagram Protocol）
  无连接、不可靠数据传输、无流量控制、无拥塞控制
### 1.2.3 两种连接的应用
使用TCP的应用：HTTP(Web), FTP(文件传送), Telnet(远程登录), SMTP(email)
使用UDP的应用：流媒体、远程会议、DNS、Internet电话
## 1.3 网路核心
路由器的网状结构
问题：数据是怎样通过网络进行传输的？
- 电路交换：为每个呼叫预留一条专有电路：如电话网
- 分组交换：
  - 将要传输的数据分为一个个单位，叫做分组
  - 将分组从一个路由器传到相邻路由器（hop），一段段最终从源端传到目标端
  - 每段：采用链路的最大传输能力（带宽）
### 1.3.1 电路交换
端到端的资源被分配给从源端到目标端到呼叫“call”
1）独享资源：不共享，每个呼叫一旦建立起来就能够保证性能
2）如果呼叫没有数据发送，被分配的资源就会被浪费
3）通常被传统电话网络采用
信道复用:
- 时分复用
- 频分复用
- 波分复用
### 1.3.2 电路交换结论
电路交换不适合计算机之间的通信
- 连接建立时间长
- 计算机之间的通信有突发性，如果使用线路交换，则浪费的片段比较多
  - 即使这个呼叫没有数据传输，其所占据的片也不能被别的呼叫使用
- 可靠性不高
### 1.3.3 分组交换
#### 以分组为单位存储-转发方式
- 网络带宽资源不再分为一个片，传输时使用全部带宽
- 主机之间传输的数据被分为一个个分组
#### 资源共享，按需使用
- 存储-转发：分组每次移动一跳（hop）
  - 在转发之前，节点必须收到整个分组
  - 延迟比电路交换大
  - 排队时间
  - 被传输到下一个链路之前，整个分组必须到达路由器：存储转发
  - 在一个速率为R bps的链路，一个长度为L bits的分组的存储转发延时：L/R s
#### 排队延迟和丢失
- 如果到达速率>链路的输出速率：
  - 分组将会排队，等待传输
  - 如果路由器的缓存用完了，分组将会被抛弃
#### 网络核心的关键功能
路由：决定分组采用的源到目标的路径  
转发：将分组从路由器的输入链路转移到输出链路
#### 分组交换：统计多路复用
随机的划分时间片来使用链路资源
#### 分组交换 vs 电路
分组交换支持更多用户同时使用，它是突发数据的胜利者
- 适合于对突发式数据传输
  - 资源共享
  - 简单，不必建立呼叫
- 过度使用会造成网络拥塞：分组延时于丢失
  - 对可靠地数据传输需要协议来约束：拥塞控制
#### datagram工作原理
- 在通信之前，无需建立起一个连接，有数据就传输
- 每一个分组都拥有独立路由（路径不一样，可能会失序）
- 路由器根据分组的目标地址进行路由
## 1.4 接入网和物理媒体
### 住宅接入：modem
- 将上网数据调制加载音频信号上，将电话线上传输，在局端将其中的数据解调出来，反之依然
  - 调频
  - 调幅
  - 调相位
  - 综合调制
- 拨号调制解调器
  - 56Kbps的速率直接接入路由器（通常更低）
  - 不能同时上网和打电话，不能总是在线
### 接入网：ditital subscriber line (DSL)
- 采用现存的到交换局DSLAM的电话线
  - DSL线路上的数据被传到互联网
  - DSL线路上的语音数据到电话网
- < 2.5Mbps上行传输速率
- < 24 Mbps下行传输速率
### 接入网：线缆网络
有线电视信号线缆双向改造
FDM：在不同频段传输不同信道的数据
数字电视和上网数据（上下行）
- HFC: hybrid fiber coat
  - 非对称：最高30Mbps的下行传输速率，2Mbps上行传输速率
- 线缆和光纤网络将各个家庭用户接入到ISP路由器
- 各用户共享线缆头端的接入网络
  - 与DSL不同，DSL每个用户一个专用线路到CO（center office）
### 物理媒体
- Bit：在发送-接收对间传播
- 物理链路：连接每个发送-接收对之间的物理媒体
- 导引型媒体：信号沿着固体媒介被导引，同轴电缆、光纤、双绞线
- 非导引型媒体：开放的空间传输电磁波或者光信号中承载数字信号
- 双绞线
  - 两根绝缘铜导线拧合
    - 5类：100Mbps以太网，Gbps千兆以太网
    - 6类：10Gbps万兆以太网
- 同轴电缆
  - 两根同轴的铜导线
  - 双向
  - 基带电缆：
    - 电缆上一个单个信道
    - Ethernet
  - 宽带电缆：
    - 电缆上有多个信道
    - HFC
- 光纤和光缆：
  - 光脉冲，每个脉冲表示一个bit，在玻璃纤维中传输
  - 高速：
    - 点到点的高速传输（如10Gbps-100Gbps传输速率）
  - 低误码率：在两个中继器之间可以有很长的距离，不受电磁噪声的干扰
  - 安全
- 无线链路类型
  - 地面微波
  - LAN
  - wide-area
  - 卫星
    - 每个信道Kbps到45Mbps
    - 270 msec端到端延迟
    - 同步静止卫星和低轨卫星
## 1.5 Internet结构和ISP
### 互联网络结构：网络的网络
- 端系统通过接入ISPs连接到互联网
  - 住宅，公司和大学的ISPs
- 接入ISPs相应的必须是互联的
  - 因此任何两个端系统可互相发送分组到对方
- 导致的“网络的网络”非常复杂
  - 发展和演化是通过经济的和国家的政策来驱动的
- 让我们采用渐进方法来描述当前互联网的结构

如何连接所有ISP
利用global ISP
客户ISPs和提供者ISPs有经济合约
竞争：如果全局ISP是有利可为的业务，那会有竞争者
合作：通过ISP之间的合作可以完成业务的拓展，肯定会有互联，对等互联的结算关系
互联网内容提供商（Internet Content Provider e.g. Google, Baidu）
如美国谷歌服务器，给南非客户提供服务，需要很多跳，费用高昂。这时候谷歌就会考虑自己构建（租或搭）它的网络，一般靠近核心ISP，将它们的服务、内容更加靠近端用户，向用户提供更好的服务，减少自己的运营支出
结构：
- 松散的层次模型
- 中心：第一层ISP国家/国际覆盖，速率极高
  - 直接与其他第一层ISP项链
  - 与大量的第二层ISP和其他客户网络相连
- 第二层ISP：更小些的ISP
  - 与一个或多个第一层ISPs，也可能与其他第二层ISP
- 第三层ISP与其他本地ISP
  - 接入网（与端系统最近）
### ISP之间的连接
- POP：高层ISP面向客户网络的接入点，涉及费用结算
  - 如一个底层ISP接入多个高层ISP，多宿
- 对等接入：2个ISP对等互接，不涉及费用结算
- IXP，多个对等ISP互联互通之处，通常不涉及费用结算
  - 对等接入
- ICP自己部署专用网络，同时和各级ISP连接
## 1.6 分组延时、丢失和吞吐量
### 分组丢失和延时的原因
在路由器缓冲区的分组队列
- 分组到达链路的速率超过了链路输出的能力
- 分组等待排到队头、被传输
### 四种分组延时
1. 节点处理延时
   - 检查bit级差错
   - 检查分组首部和决定将分组导向何处
2. 排队延时
   - 在输出链路上等待传输的时间
   - 依赖于路由器的拥塞程度
3. 传输延时
   - R=链路带宽(bps)
   - L=分组长度(bps)
   - 将分组发送到链路上的时间L/R
   - 存储转发延时
4. 传播延时
   - d = 物理链路的长度
   - s = 在媒体上的传播速度($2*10^{8}m/sec$)
   - 传播延时 = d/s

节点延时（每一跳）
$$d_{nodal}=d_{proc}+d_{queue}+d_{trans}+d_{prop}$$
- $d_{proc}$=处理延时
  - 通常是微妙数量级或更少
- $d_{queue}$=排队延时
  - 取决于拥塞程度
- $d_{trans}$=传输延时
  - =L/R，对低速率的链路而言很大（如拨号），通常为微秒级到毫秒级
- $d_{prop}$=传播延时
  - 几微秒到几百毫秒
### 排队延时
- R=链路带宽(bps)
- L=分组长度(bits)
- a=分组到达队列的平均速率
- 流量强度 = La/R
  - La/R ~ 0:平均排队延时很小
  - La/R -> 1:延时变得很大
  - La/R > 1:比特到达队列的速率超过了从该队列输出的速率，平均排队延时将趋于无穷大
### 分组丢失
- 链路的队列缓冲区容量有限
- 当分组到达一个满的队列时，该分组将会丢失
- 丢失的分组可能会被前一个节点（链路层可靠）或源端系统重传（TCP），或根本不重传（UDP）
### 吞吐量
- 在源端和目标端之间传输的速率（数据量/单位时间）
  - 瞬间吞吐量：在一个时间点的速率
  - 平均吞吐量：在一个长时间内平均值
- 瓶颈链路：端到端路径上，限制端到端吞吐的链路
## 1.7 协议层次及服务模型
网络是一个复杂的系统
- 网络功能繁杂：数字信号的物理信号承载、点到点、路由、rdt、进程区分、应用等
- 现实来看，网络的许多构成元素和设备：
  - 主机
  - 路由器
  - 各种媒体的链路
  - 应用
  - 协议
  - 硬件，软件
- 层次化方式实现复杂网路功能
  - 将复杂网络的功能分层成功能明确的层次，每一层实现了其中一个或一组功能，功能中有其上层可以使用的功能：服务
  - 本层协议实体相互交互执行本层的协议动作，目的是实现本层功能，通过接口为上层提供更好的服务
  - 在实现本层协议的时候，直接利用了下层所提供的服务
  - 本层的服务：借助下层服务实现的本层协议实体之间交互带来的新功能（上层可以利用的）+更下层所提供的服务

服务和服务访问点
- 服务（service）：低层实体向上层实体提供它们之间的通信的能力
  - 服务用户（service user）
  - 服务提供者（service provider）
- 原语（primitive）：上层使用下层服务的形式，高层使用低层提供的服务，以及低层向高层提供服务都是通过服务访问原语来进行交互的---形式
- 服务访问点SAP（Service Access Point）：上层使用下层提供的服务通过层间的接口---地点
  - 例子：邮箱
  - 地址（address）：下层的一个实体支撑着上层的多个实体，SAP有标志不同上层实体的作用
  - 可以有不同的实现，队列
  - 例子：传输层的SAP：端口（port）

服务的类型
- 面向连接的服务（Connection-oriented Service）
  - 连接（Connection）：两个通信实体为进行通信而建立的一种结合
  - 面向连接的服务通信的过程：建立连接，通信，拆除连接
  - 面向连接的服务的例子：网络层的连接被称为虚电路
  - 适用范围：对于大的数据块要传输；不适合小的零星报文
  - 特点：保序
  - 服务类型：
    - 可靠的信息流 传送页面（可靠的获得，通过接收方的确认）
    - 可靠的字节流 远程登录
    - 不可靠的连接 数字化声音
- 无连接的服务（Connectionless Service）
  - 无连接服务：两个对等实体在通信前不需要建立一个连接，不预留资源；不需要通信双方都是活跃；（例：寄信）
  - 特点：不可靠、可能重复、可能失序
  - IP分组，数据包
  - 适用范围：适合传送零星数据；
  - 服务类型：
    - 不可靠的数据报 电子方式的函件
    - 有确认的数据报 挂号信
    - 请求回答 信息查询

服务和协议
- 服务与协议的区别
  - 服务（Service）：低层实体向上层实体提供它们之间的通信的能力，是通过原语（primitive）来操作的，垂直
  - 协议（protocol）：对等层实体（peer entity）之间在相互通信的过程中，需要遵循的规则的集合，水平
- 服务与协议的联系
  - 本层协议的实现要靠下层提供的服务来实现
  - 本层实体通过协议为上层提供更高级的服务

数据单元（DU）
- SAP = Service Access Point
- IDU = Interface Data Unit
- SDU = Service Data Unit
- PDU = Protocol Data Unit
- ICI = Interface Control Information
- 上层要传输一个SDU给本层，需要通过SAP，通过SAP需要在SDU前面加上ICI，组成IDU，IDU经过SAP，到达本层，ICI拆开，SDU加上本层协议生成的header形成本层的PDU，而这个本层的PDU，往下传到下一层时，就成为了SDU

分层处理和实现复杂系统的好处
- 概念化：结构清晰，便于标示网络组件，以及描述其相互关系
  - 分层参考模型
- 结构化：模块化更易于维护和系统升级
  - 改变某一层服务的实现不影响系统中的其他层次
    - 对于其他层次而言是透明的
  - 如何改变登记程序并不影响系统的其他部分
    - 改变2个秘书使用的通信方式不影响两个翻译的工作
    - 改变2个翻译使用的语言也不影响上下两个层次的工作

Internet协议栈
- 应用层：网络应用
  - 为人类用户或其他应用进程提供网络应用服务
  - FTP，SMTP，HTTP，DNS
- 传输层：主机之间的数据传输
  - 在网络层提供的端到端通信基础上，细分为进程到进程，将不可靠的通信变成可靠的通信
  - TCP，UDP
- 网络层：为数据报从源到目的选择路由
  - 主机与主机之间的通信，端到端通信，不可靠
  - IP，路由协议
- 链路层：相邻网络节点间的数据传输
  - 2个相邻2点的通信，点到点通信，可靠或不可靠
  - 点对点协议PPP，802.11（wifi），Ethernet
- 物理层：在线路上传送bit

ISO/OSI参考模型
- 表示层：允许应用解释传输的数据，e.g.，加密，压缩，机器相关的表示转换
- 会话层：数据交换的同步，检查点，恢复
- 互联网协议栈没有这两层！
  - 这些服务，如果需要的话，必须被应用实现
  - 需要吗？

各层次的协议数据单元
- 应用层：报文（message）
- 传输层：报文段（segment）：TCP段，UDP数据报
- 网络层：分组packet（如果无连接方式：数据报datagram）
- 数据链路层：帧（frame）
- 物理层：位（bit）
## 1.8 历史
早期（1960年前）计算机网络
- 线路交换网络
- 线路交换的特性使得其不适合计算机之间的通信
  - 线路建立时间过长
  - 独享方式占用通信资源，不适合突发性很强的计算机之间的通信
  - 可靠性不高：非常不适合军事通信
- 三个小组独立开展分组交换的研究
  - 1961：Kleinrock(MIT)，排队论，展现了分组交换的有效性
  - 1964：Baran(美国兰德公司) - 军用网络上的分组交换
  - 1964：Donald(英国)等，NPL
- 1967：美国高级研究计划研究局考虑ARPAnet
    - Kleinrock在MIT的同事
- 1969：第一个ARPAnet节点开始工作，UCLA
  - IMP：接口报文处理机
- 1969年底：4个节点
- 1972：
  - ARPAnet公众演示
  - 网络控制协议是第一个端系统直接的主机-主机协议
    - NCP协议：相当于传输层和网络层在一起，支持应用开发
  - 第一个e-mail程序（BBN）
  - ARPAnet有15个节点
- 出现了很多对以后来说重要的网络形式，雨后春笋
  - 1970: ALOHAnet，夏威夷上的微波网络
  - 1973: Metcalfe在博士论文中提出了Ethernet
  - ATM网络
  - ALOHAnet，Telnet，Cyclades法国等
- 1970后期，网络体系结构的必要性
  - 专用的体系结构：DECnet，SNA，XNA
  - 标准化的体系结构
- 1974: 网络互联的Cerf and Kahn体系结构
  - 极简、自治
  - 尽力而为（best effort）服务模型
  - 无状态的路由器
  - 分布控制
- 1979: ARPAnet的规模在持续增加，体系结构也在酝酿着变化，以支持网络互联和其他目的（性能）需求
  - 节点数目增加，有200个节点
- 1983: TCP/IP部署，标记日
  - NCP分化成2个层次，TCP/IP，从而出现UDP
  - 覆盖式IP解决网络互联问题
  - 主机设备和网络交换设备分开
- 1982: smtp e-mail协议定义
- 1983: DNS定义，完成域名到IP地址的转换
- 1985: ftp协议定义
- 1988: TCP拥塞控制
- 其他网络形式的发展
  - 新的国家级网络：Csnet，BITnet，NSFnet，Minitel
  - 1985年：ISO/OSI提出，时机不对且太繁琐
- 100000台主机连接到网络联邦
- 1990年代初：NSF对ARPAnet的访问网，双主干，ARPAnet退役
- 1991: NSF放宽了对NSFnet用于商业目的的限制（1995退役），ASFNET非盈利性机构维护，后面叫Internet
- UNIX中TCP/IP的免费捆绑
- 1990年代初：Web
  - hypertext[Bush 1945, Nelson 1960' s]
  - HTML, HTTP: Berners-Lee
  - 1994: Mosaic(Netscape, andreesen)
  - 1990年代后期:Web的商业化
- TCP/IP体系结构的包容性，在其上部署应用便捷，出现非常多的应用
- 新一代杀手级应用（即时讯息，P2P文件共享，社交网络等）更进一步促进了互联网的发展
- 安全问题不断出现和修订（互联网的补丁原则）
- 2001网络泡沫，使得一些好公司沉淀下来（谷歌，微软，苹果，Yahoo，思科）
- 主干网速率达到Gbps
- ~50亿+主机：包括智能手机和平板
- 宽带接入的快速部署
- 高速无线接入无处不在：移动互联时代
  - 4G部署，5G蓄势待发
  - 带宽大，终端性能高，价格便宜，应用不断增多
- 在线社交网络等新型应用出现：
  - Fackbook：10亿用户
  - 微信，qq：数十亿用户
- 内容提供商（Google，Microsoft）创建他们自己的网络
  - 通过自己的专用网络提供对搜索、视频内容和电子邮件的即刻访问
- 电子商务，大学，企业在云中运行它们的服务(eg, Amazon EC2)
- 体系结构酝酿着大的变化，未来网络蠢蠢欲动
# 2 提纲
## 2.1 应用层协议原理
### 2.1.1 目标
- 网络应用的原理：网络应用协议的概念和实现方面
  - 传输层的服务模型
  - 客户-服务器模式
  - 对等模式(peer-to-peer)
  - 内容分发模式
- 网络应用的实例：互联网流行的应用层协议
  - HTTP
  - FTP
  - SMTP/POP3/IMAP
  - DNS
- 编程：网络应用程序
  - Socket API
### 2.1.2 创建一个新的网络应用
- 编程
  - 在不同的端系统上运行
  - 通过网络基础设施提供的服务，应用进程彼此通信
  - 如Web：
    - Web服务器软件与浏览器软件通信
- 网络核心中没有应用层软件
  - 网络核心没有应用层功能
  - 网络应用只在端系统上存在，快速网络应用开发和部署
### 2.1.3 网络应用的体系结构
可能的应用架构：
- 客户-服务器模式(C/S:client/server)
- 对等模式(P2P:Peer To Peer)
- 混合体：客户-服务器和对等体系结构
### 2.1.4 客户-服务器(C/S)体系结构
- 服务器
  - 一直运行
  - 固定的IP地址和周知的端口号(约定)
  - 扩展性：服务器场
    - 数据中心进行扩展
    - 扩展性差
- 客户端
  - 主动与服务器通信
  - 与互联网有间歇性的连接
  - 可能是动态IP地址
  - 不直接与其他客户端通信
### 2.1.5 对等体(P2P)体系结构
- (几乎)没有一直运行的服务器
- 任意端系统之间可以进行通信
- 每一个节点既是客户端又是服务器
  - 自扩展性-新peer节点带来新的服务能力，当然也带来新的服务请求
- 参与的主机间歇性连接且可以改变IP地址
  - 难以管理
- 例子：Gnutella，迅雷
### 2.1.6 C/S和P2P体系结构的混合体
- Napster
  - 文件搜索：集中
    - 主机向中心服务器上注册其资源
    - 主机向中心服务器查询资源位置
  - 文件传输：P2P
    - 任意Peer节点之间
- 即时通信
  - 在线检测：集中
    - 当用户上线时，向中心服务器注册其IP地址
    - 当用户与中心服务器联系，以找到其在线好友的位置
  - 两个用户之间聊天：P2P
### 2.1.7 进程通信
- 进程：主机上运行的应用程序
- 在同一个主机内，使用进程间通信机制通信(操作系统定义)
- 不同主机，通过交换报文(Message)来通信
  - 使用OS提供的通信服务
  - 按照应用协议交换报文
    - 借助传输层提供的服务
- 注意：P2P架构的应用也有客户端进程和服务器进程之分
### 2.1.8 分布式进程通信需要解决的问题
- 问题1:进程标示和寻址问题(服务用户)
  - 对进程进行编址(addressing)
    - 进程为了接收报文，必须有一个标识，即：SAP(发送也需要标示)
      - 主机：唯一的32位IP地址
        - 仅仅有IP地址不能够唯一标示一个进程，在一台端系统上有很多应用进程在通信
      - 所采用的传输层协议：TCP or UDP
      - 端口号(Port Numbers)
    - 一些知名端口号的例子：
      - HTTP: TCP 80 Mail TCP 25 ftp: TCP 2
    - 一个进程：用IP + port 标示 端节点
    - 本质上，一对主机进程之间的通信由两个端节点构成
- 问题2:传输层-应用层提供服务是如何(服务)
  - 位置：层间界面的SAP(TCP/IP: socket)
  - 形式：应用程序接口API(TCP/IP: socket API)
  - 问题解决
    - 层间接口必须要携带的信息
      - 要传输的报文(对于本层来说：SDU)
      - 谁传的：对方的应用进程的标示：IP+TCP(UDP) 端口
      - 传给谁：对方的应用进程的标示：对方的IP+TCP(UDP) 端口号
    - 传输层实体(tcp或udp实体)根据这些信息进行TCP报文段(UDP数据报)的封装
      - 源端口号，目标端口号，数据等
      - 将IP地址往下交IP实体，用于封装IP数据报：源IP，目标
    - 如果Socket API每次传输报文，都携带如此多的信息，太繁琐易错，不便于管理
    - 用个代号标示通信的双方或者单方：socket
    - 就像OS打开文件返回的句柄一样
      - 对句柄的操作，就是对文件的操作
    - TCP socket
      - TCP服务，两个进程之间的通信需要之前建立连接
        - 两个进程通信会持续一段时间，通信关系稳定
      - 可以用一个整数表示两个应用实体之间的通信关系
        - 本地标示
      - 穿过层间接口的信息量最小
      - TCP socket：源IP，源端口，目标IP，目标端口
    - 对于使用面向连接服务(TCP)的应用而言，套接字是4元组的一个具有本地意义的标示
      - 4元组：(源IP，源port，目标IP，目标port)
      - 唯一的指定了一个会话(2个进程之间的会话关系)
      - 应用使用这个标示，与远程的应用进程通信
      - 不必在每一个报文的发送都要指定这4元组
      - 就像使用操作系统打开一个文件，OS返回一个文件句柄一样，以后使用这个文件句柄，而不是使用这个文件的目录名，文件名
      - 简单，便于管理
    - UDP socket
      - UDP服务，两个进程之间的通信之前无需建立连接
        - 每个报文都是独立传输的
        - 前后报文可能给不同的分布式进程
      - 因此，只能用一个整数表示本地应用实体的标示
        - 因为这个报文可能传给另一个分布式进程
      - 穿过层间接口的信息大小最小
      - UDP socket: 本IP，本端口
      - 但是传输报文时，必须要提供对方IP，port 
        - 接收报文时，传输层需要上传对方的IP，port
    - 对于使用无连接服务(UDP)的应用而言，套接字是2元组的一个具有本地意义的标示
      - 2元组：IP，port(源端指定)
      - UDP套接字指定了应用所在的一个端节点(end point)
      - 在发送数据报时，采用创建好的本地套接字(标示ID)，就不必在发送每个报文中指明自己所采用的ip和port
      - 但是在发送报文时，必须要指定对方的ip和udp port(另外一个端节点)
- 问题3:如何使用传输层提供的服务，实现应用进程之间的报文交换，实现应用(用户使用服务)
  - 定义应用层协议：报文格式、解释、时序等
    - 定义了运行在不同端系统上的应用进程如何相互交换报文
      - 交换的报文类型：请求和应答报文
      - 各种报文类型的语法：报文中的各个字段及其描述
      - 字段的定义：即字段取值的含义
      - 进程何时、如何发送报文及对报文进行响应的规则
    - 应用协议仅仅是应用的一个组成部分
      - Web应用：HTTP协议，web客户端，web服务器，HTML
    - 公开协议
      - 由RFC文档定义
      - 允许互操作
      - 如HTTP、SMTP
    - 专用协议
      - 协议不公开
      - 如：Skype
  - 编制程序，使用OS提供的API，调用网络基础设施提供通信服务传报文，实现应用时序等；
### 2.1.9 套接字
- 进程向套接字发送报文或从套接字接收报文
- 套接字<->门户
  - 发送进程将报文推出门户，发送进程依赖于传输层设施在另外一侧的门将报文交付给接受进程
  - 接收进程从另外一端的门户收到报文(依赖于传输层设备)
### 2.1.10 应用层需要传输层提供的服务
- 数据丢失率
  - 有些应用要求100%的可靠数据传输(如文件)
  - 有些应用(如音频)能容忍一定比例以下的数据丢失
- 延迟
  - 一些应用出于有效性考虑，对数据传输有严格的时间限制
    - Internet电话，交互式游戏
    - 延迟、延迟差
- 吞吐
  - 一些应用(如多媒体)必须需要最小限制的吞吐，从而使得应用能够有效运转
  - 一些应用能充分利用可供使用的吞吐(弹性应用)
- 安全性
  - 机密性
  - 完整性
  - 可认证性(鉴别)
### 2.1.11 Internet传输层提供的服务
- TCP服务
  - 可靠的传输服务
  - 流量控制：发送方不会淹没接收放
  - 拥塞控制：当网络出现拥塞时，能抑制发送方
  - 不能提供的服务：时间保证、最小吞吐量保证和安全
- UDP服务：
  - 不可靠数据传输
  - 不提供的服务：可靠、流量控制、拥塞控制、时间、带宽保证、建立连接
- UDP存在的必要性
  - 能够区分不同的进程，而IP服务不能
    - 在IP提供的主机到主机端到端功能的基础上，区分了主机的应用进程
  - 无需建立连接，省去了建立连接时间，适合事务性的应用
  - 不做可靠性的工作，例如检错重发，适合那些对实时性要求比较高而对正确性要求不高的应用
    - 因为为了实现可靠性(准确性、保序等)，必须付出时间代价(检错重发)
  - 没有拥塞控制和流量控制，应用能够按照设定的速度发送数据
    - 而在TCP上面的应用，应用发送数据的速度和主机向网络发送的实际速度是不一样的，因为有流量控制和拥塞控制
### 2.1.12 安全性
- TCP&UDP
  - 都没有加密
  - 明文通过互联网传输，甚至密码
- SSL
  - 在TCP上面实现，提供加密的TCP连接
  - 私密性
  - 数据完整性
  - 端到端的鉴别
- SSL在应用层
  - 应用采用SSL库，SSL库使用TCP通信
- SSL socket API
  - 应用通过API将明文交给socket，SSL将其加密在互联网上传输
## 2.2 Web and HTTP
### 2.2.1 一些术语
- Web页：由一些对象组成
- 对象可以是HTML文件、JPEG文件、Java小程序、声音剪辑文件等
- Web页含有一个基本的HTML文件，该基本HTML文件又包含若干对象等引用(链接)
- 通过URL对每个对象进行引用
  - 访问协议，用户名，口令字，端口等；
- URL格式
  - Prot://user:psw@www.someSchool.edu/someDept/pic.git:port
  - Prot协议名
  - user:psw用户:口令
  - www.someSchool.edu主机名
  - someDept/pic.gif路径名
  - port端口
### 2.2.2 HTTP概况
HTTP:超文本传输协议
- Web的应用层协议
- 客户/服务器模式
  - 客户：请求、接收和显示Web对象的浏览器
  - 服务器：对请求进行响应，发送对象的Web服务器
- HTTP 1.0: RFC 1945
- HTTP 1.1: RFC 2068

使用TCP：
- 客户端发起一个与服务器的TCP连接(建立套接字)，端口号为80
- 服务器接受客户的TCP连接
- 在浏览器(HTTP客户端)与Web服务器(HTTP服务器server)交换HTTP报文(应用层协议报文)
- TCP连接关闭

HTTP是无状态的
- 服务器并不维护关于客户的任何信息
### 2.2.3 HTTP连接
非持久HTTP
- 最多只有一个对象在TCP连接上发送
- 下载多个对象需要多个TCP连接
- HTTP/1.0使用非持久连接

持久HTTP
- 多个对象可以在一个(在客户端和服务器之间的)TCP连接上传输
- HTTP/1.1默认使用持久连接

### 2.2.4 响应时间模型
往返时间RTT(round-trip time): 一个小的分组从客户端到服务器，再回到客户端到时间(传输时间忽略)

响应时间：
- 一个RTT用来发起TCP连接
- 一个RTT用来HTTP请求并等待HTTP响应
- 文件传输时间
- 共：2RTT+传输时间
### 2.2.5 持久HTTP
非持久HTTP的缺点
- 每个对象要2个RTT
- 操作系统必须为每个TCP连接分配资源
- 但浏览器通常打开并行TCP连接，以获取引用对象

持久HTTP
- 服务器在发送响应后，仍保持TCP连接
- 在相同客户端和服务器之间的后续请求和响应报文通过相同的连接进行传送
- 客户端在遇到一个引用对象的时候，就可以尽快发送该对象的请求

非流水线方式的持久HTTP
- 客户端只能在收到前一个响应后才能发出新的请求
- 每个引用对象花费一个RTT

流水方式的持久HTTP
- HTTP/1.1的默认模式
- 客户端遇到一个引用对象就立即产生一个请求
- 所有引用(小)对象只花费一个RTT式可能的
### 2.2.6 HTTP请求报文
- 两种类型的HTTP报文：请求，响应
- HTTP请求报文：
  - ASCII(人能阅读)
- 提交表单输入
  - Post方式
    - 网页通常包括表单输入
    - 包含在实体主体(entity body)中的输入被提交到服务器
  - URL方式
    - 方法：GET
    - 输入通过请求行的URL字段上载
- 方法类型
  - HTTP/1.0
    - GET
    - POST
    - HEAD
      - 要求服务器在响应报文中不包含请求对象->故障跟踪
  - HTTP/1.1 
    - GET, POST, HEAD
    - PUT
      - 将实体主体中的文件上载到URL字段规定的路径
    - DELETE
      - 删除URL字段规定的文件
### 2.2.7 HTTP响应报文
HTTP响应状态码，位于服务器->客户端的响应报文的首行
- 200 OK
  - 请求成功，请求对象包含在响应报文的后续部分
- 301 Moved Permanently
  - 请求的对象已经被永久转移了；新的URL在响应报文的Location；首部行中指定
  - 客户端软件自动用新的URL去获取对象
- 400 Bad Request
  - 一个通用的差错代码，表示该请求不能被服务器解读
- 404 Not Found
  - 请求的文档在该服务器上没有找到
- 505 HTTP Version Not Supported
### 2.2.8 用户-服务器状态：cookies
大多数主要的门户网站使用cookies，例子：
- Susan总是用同一个PC使用IE上网
- 她第一次访问了一个使用了Cookie的电子商务网站
- 当最初的HTTP请求到达服务器时，该Web站点产生一个唯一的ID，并以此作为索引在它的后端数据库中产生一个项

4个组成部分
- 在HTTP响应报文中有一个cookie的首部行
- 仔HTTP请求报文含有一个cookie的首部行
- 在用户端系统中保留有一个cookie文件，由用户端浏览器管理
- 在Web站点有一个端数据库

Cookies能带来什么
- 用户验证
- 购物车
- 推荐
- 用户状态
### 2.2.9 Web缓存(代理服务器)
目标：不访问原始服务器，就满足客户的请求
- 用户设置浏览器：通过缓存访问Web
- 浏览器将所有的HTTP请求发给缓存
  - 在缓存中的对象：缓存直接返回对象
  - 如对象不在缓存，缓存请求原始服务器，然后再将对象返回给客户端
- 缓存既是客户端又是服务器
- 通常缓存是由ISP安装(大学、公司、居民区ISP)

为什么要使用Web缓存？
- 降低客户端的请求响应时间
- 可以大大减少一个机构内部网络与Internet接入链路上的流量
- 互联网大量采用了缓存：可以使较弱的ICP也能够有效提供内容

缓存示例
- 平均对象大小100kb
- 机构内浏览器对原始服务器的平均请求率为15请求/s
- 平均到浏览器的速率：1.5Mbps
- 机构内部路由器到原始服务器再返回到路由器的延时(Internet延时)=2s
- 接入链路带宽：1.54Mbps
- LAN的流量强度=15%
- 接入链路上的流量强度=99%
- 总延时=LAN延时+接入延时+Internet延时=ms+分+2s
  
## 2.3 FTP*
### 2.3.1 FTP: 文件传输协议
- 向远程主机上传输文件或从远程主机接收文件
- 客户/服务器模式
  - 客户端：发起传输的一方
  - 服务器：远程主机
- ftp： RFC 959
- fpt服务器：端口号为21
### 2.3.2 控制连接与数据连接分开
- FTP客户端与FTP服务器通过端口21联系，并使用TCP为传输协议
- 客户端通过控制连接获得身份确认
- 客户端通过控制连接发送命令浏览远程目录
- 收到一个文件传输命令时，服务器打开一个客户端的数据连接
- 一个文件传输完成后，服务器关闭连接
- 服务器打开第二个TCP数据连接用来传输另一个文件
- 控制连接：带外（out of band）传送
- FTP服务器维护用户的状态信息：当前路径、用户账户与控制连接对应
## 2.4 Email (SMTP POP3 IMAP)
### 2.4.1 三个主要组成部分
- 用户代理
  - 又名“邮件阅读器”
  - 撰写、编辑和阅读邮件
  - 如Outlook、Foxmail
  - 输出和输入邮件保存在服务器上
- 邮件服务器
  - 邮箱中管理和维护发送给用户的邮件
  - 输出报文队列保持待发送邮件报文
  - 邮件服务器之间的SMTP协议：发送email报文
    - 客户：发送方邮件服务器
    - 服务器：接收端邮件服务器
- 简单邮件传输协议：SMTP
  - 使用TCP在客户端和服务器之间传送报文，端口号为25
  - 直接传输：从发送方服务器到接收方服务器
  - 传输到3个阶段
    - 握手
    - 传输报文
    - 关闭
  - 命令/响应交互
    - 命令：ASCII文本
    - 响应：状态码和状态信息
  - 报文必须为7位ASCII码

### 2.4.2 邮件报文格式
- SMTP：交换email报文的协议
- RFC822:文本报文的标准
  - 首部行：如，
    - To:
    - From:
    - Subject:
    - 和SMTP命令不同
  - 主体：
    - 报文，只能是ASCII码字符
- MIME: 多媒体邮件拓展
- 在报文首部用额外的行申明MIME内容类型,如base64
### 2.4.3 邮件访问协议
- SMTP：传送到接收方的邮件服务器
- 邮件访问协议：从服务器访问邮件
  - POP：有句访问协议(Post Office Protocol)
    - 用户身份确认(代理->服务器)并下载
  - IMAP: Internet邮件访问协议(Internet Mail Access Protocol)
    - 更多1特性
    - 在服务器上处理存储的报文
  - HTTP: Hotmail, Yahoo! Mail等
    - 方便



## 2.5 DNS
## 2.6 P2P
## 2.7 CDN
## 2.8 TCP套接字(Socket)编程
## 2.9 UDP套接字编程
