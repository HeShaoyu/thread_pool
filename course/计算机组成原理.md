# 课程名称：计算机组成原理
- 计算机
- 组成
- 原理
### 讲授内容
- 基本部件结构和组织方式
- 基本运算的操作原理
- 基本部件和单元的设计思想
### 特色
- 计算机组成的一般原理，不以具体机型为依托
- 采用自顶向下的方式、层层细化
# 1 计算机系统简介
## 1.1现代计算机系统的多态性
把感应器嵌入和装备到电网、铁路、桥梁、隧道、公路、建筑、供水系统、大坝、油气管道等各种物体中，并且被普遍连接，形成所谓“物联网”，然后将“物联网”与现有的互联网整合起来，实现人类社会与物理系统的整合，形成智慧地球
## 1.2 计算机的软硬件概念
### 1.2.1 计算机系统
- 硬件 计算机的实体，如主机、外设等
- 软件 由具有各类特殊功能的信息（程序）组成
### 1.2.2 系统软件
用来管理整个计算机系统
- 语言处理程序
- 操作系统
- 服务性程序
- 数据库管理系统
- 网络软件
### 1.2.3 应用软件
按任务需要编制的各种程序
### 1.2.4 计算机系统的层次结构
系统复杂性管理的方法
- 抽象
微指令系统 -> 机器语言 -> 操作系统 -> 汇编语言 -> 高级语言
微程序机器M0 -> 实际机器M1 -> 虚拟机器 -> 虚拟机器M2 -> 虚拟机器M3
- 虚拟机器M4 用编译程序翻译成汇编语言
- 虚拟机器M3 用汇编程序翻译成机器语言
- 虚拟机器M2 用机器语言解释操作系统
-------------------------------上面软件，下面硬件
- 实际机器M1 用微指令解释机器指令
- 微程序机器M0 由硬件直接执行微指令
## 1.3 计算机体系结构和计算机组成
### 1.3.1 计算机体系结构
程序员所见到的计算机系统的属性，概念性的结构与功能特性
（指令系统、数据类型、寻址技术、I/O机理）
计算机组成：实现计算机体系结构所体现的属性
（具体指令的实现）
### 1.3.2 计算机的基本组成
#### 1）冯诺依曼计算机的特点
- 计算机由五大部件组成
- 指令和数据以同等地位存于寄存器，可按照地址寻访
- 指令和数据用二进制表示
- 指令由操作码和地址码组成
- 存储程序（核心）
- 以运算器为中心

#### 2）现代计算机
- 运算器
- 控制器
- 存储器
- 输入设备
- 输出设备
#### 3）系统复杂性管理的方法
- 层次化：将被设计的系统划分为多个模块或子模块
- 模块化：有明确定义的功能和接口
- 规则性：模块更容易被重用
### 1.3.3 计算机的工作步骤
- 建立数学模型
- 确定计算方法
- 编制阶梯程序
- - 程序 运算的全部步骤
- - 指令 每一个步骤

#### 计算$ax^2+bx+c$的流程
- 取x至运算器中
- 乘以x在运算器中
- 乘以a在运算器中
- 存$ax^2$在存储器中
- 取b至运算器中
- 乘以x在运算器中
- 加$ax^2$在运算器中
- 加c在运算器中

#### 计算$(ax+b)x+c$
- 取x至运算器中
- 乘以a在运算器中
- 加b在运算器中
- 乘以x在运算器中
- 加c在运算器中
#### 指令格式举例
取数 a              [a]->ACC
000001 0000001000
存数 b              [ACC]->b
加   r              [ACC] + [r] -> ACC
打印 c               [c] -> 打印机
停机
#### 存储器的基本组成
- 存储单元 存放一串二进制代码
- 存储字 存储单元中二进制代码的组合
- 存储字长 存储单元中二进制代码的位置，每个存储单元赋予一个地址
- 按地址寻访
- MAR
  - 存储器地址寄存器
  - 反映存储单元的个数
- MDR
  - 存储器数据寄存器
  - 反映存储字长
#### 控制器的基本结构
- 控制器的功能
  - 解释指令
  - 保证指令的按序执行
- 完成一条指令
  - 取指令 PC，存放当前欲执行指令的地址，具有计数功能(PC)+1->PC
  - 分析指令 IR存放当前欲执行的指令
  - 执行指令 CU
#### 程序运行过程
- 将程序通过输入设备送至计算机
- 程序首地址->PC
- 启动程序运行
- 取指令 PC -> MAR -> M -> MDR -> IR, (PC)+1 -> PC
- 分析指令 OP(IP) -> CU
- 执行指令 Ad(IR) -> MAR -> M -> MDR -> ACC
- ...
- 打印结果
- 停机
### 1.3.4 计算机硬件的主要技术指标
1. 机器字长
  - CPU一次能处理数据的位数，与CPU中的寄存器位数有关
2. 运算速度
  - 主频
  - 核数，每个核支持的线程数
  - 吉普森法 $T_{M}=\sum_{i=1}^{n}f_{i}t_{i}$
  - CPI 执行一条指令所需时钟周期数
  - MIPS 每秒执行百万条指令
  - FLOPS 每秒浮点运算次数
3. 存储容量
  - 存放二进制信息的总位数
    - 主存容量
      - 存储单元个数*存储字长
        - 如MAR MDR 容量
      - 字节数
        - 如$2^{13}b=1KB$
    - 辅存容量
      - 字节数 80 GB
# 2 计算机的发展和应用
## 2.1 计算机的发展史
### 计算机的产生和发展
1946年 美国 ENIAC
十进制运算
18000 多个电子管
1500  多个继电器
150   千瓦
30    吨
1500  平方英尺
5000  次加法/秒
用手工搬动开关和插拔来控制
### 现代计算机产生的驱动力
- 需求、需求、还是需求
- 技术发展
  - 电子技术的发展
  - 计算机体系结构技术的发展
### 微型计算机的出现和发展
位处理器芯片 1971年   存储器芯片  1970年
### 软件技术的兴起和发展
1. 各种语言
  - 机器语言 面向机器
  - 汇编语言 面向机器
  - 高级语言 面向问题
    - FORTRAN 科学计算和工程计算
    - PASCAL 结构化程序设计
    - C++ 面向对象
    - Java 适应网络环境
2. 系统软件
  - 语言处理程序
    - 汇编程序 编译程序 解释程序
  - 操作系统
    - DOS UNIX Windows
  - 服务性软件
    - 装配 调试 诊断 排错
  - 数据库管理系统
    - 数据库和数据库管理软件
  - 网络软件
3. 软件发展的特点
- 开发周期长
- 制作成本昂贵
- 检测软件产品质量的特殊性

软件是程序以及开发、使用和维护程序所需要的所有文档
## 2.2 计算机的应用
1. 科学计算和数据处理
2. 工业控制和实时控制
3. 网络技术
   1. 电子商务
   2. 网络教育
   3. 敏捷制造
4. 虚拟现实
5. 办公自动化和管理信息系统
6. CAD/CAM/CIMS
7. 多媒体技术
8. 人工智能
## 2.3 计算机的展望
1. 计算机具有类似人脑的一些超级智能功能，要求计算机的速度足够快
2. 芯片集成度的提高受以下三方面的限制
  - 芯片集成度受物理极限的制约
  - 按几何级数递增的制作成本
  - 芯片的功耗、散热、线延迟
3. 替代传统的硅芯片
  - 光计算机
    - 利用光子取代电子进行运算和存储
  - DNA生物计算机
    - 通过控制DNA分子间的生化反应
  - 量子计算机
# 3 系统总线
## 3.1 总线的基本概念
1. 为什么要用总线
2. 什么是总线
   1. 总线是连接各个部件的信息传输线，是各个部件共享的传输介质
3. 总线上信息的传送
   1. 串行
   2. 并行
4. 总线结构的计算机举例
   1. 单总线（系统总线）
   2. 面向CPU的双总线结构
   3. 已存储器为中心的双总线结构
## 3.2 总线的分类
1. 片内总线：芯片内部的总线
2. 系统总线：计算机各部件之间的信息传输线
   1. 数据总线 双向 与机器字长、存储字长有关
   2. 地址总线 单向 与存储地址、I/O地址有关
   3. 控制总线 有出 有入
3. 通信总线
   1. 用于计算机之间或计算机系统与其他系统（如控制仪表、移动通信等）之间的通信
   2. 传输方式
      1. 串行通信总线
      2. 并行通信总线
## 3.3 总线特性及性能指标
1. 总线物理实现
2. 总线特性
   1. 机械特性 尺寸、形状、管脚数及排列顺序
   2. 电气特性 传输方向和有效的电平范围
   3. 功能特性
      1. 每根传输线的功能
         1. 地址
         2. 数据
         3. 控制
   4. 时间特性 信号与时序关系
3. 总线的性能指标
   1. 总线宽度 数据先的根数
   2. 标准传输率 每秒传输的最大字节数(MBps)
   3. 时钟同步/异步 同步、不同步
   4. 总线复用 地址线与数据线复用
   5. 信号线数 地址线、数据线和控制线的总和
   6. 总线控制方式 突发、自动、仲裁、逻辑、计数
   7. 其他指标 负载能力
4. 总线标准
   1. ISA  16MBps
   2. EISA 33MBps
   3. VESA 132MBps
   4. PCI  132MBps 528MBps
   5. AGP  266Mbps 533MBps
   6. RS-232
   7. USB  1.5Mbps(USB1.0) 12Mbps(USB1.0) 480Mbps(USB2.0)
## 3.4 总线结构
- 单总线结构
  - 总线成为瓶颈
- 多总线结构
  - 双总线结构
    - 主存总线
    - I/O总线
  - 三总线结构
    - I/O总线
    - 主存总线
    - DMA总线
    - ----------
    - 局部总线
    - 系统总线
    - 扩展总线
  - 四总线结构
    - 局部总线
    - 系统总线
    - 高速总线
    - 扩展总线
- 总线结构举例
  - 传统微型机总线结构
  - VL-BUS局部总线结构
  - PCI总线结构
  - 多层PCI总线结构
## 3.5 总线控制
### 3.5.1 总线判优控制
- 基本概念
  - 主设备（模块） 对总线有控制权
  - 从设备（模块） 响应从主设备发来的总线命令
  - 总线判优控制
    - 集中式
      - 链式查询
      - 计数器定时查询
      - 独立请求方式
    - 分布式
#### 链式查询方式
- BS 总线忙
- BR 总线请求
- BG 总线同意
- I/O接口通过BR向总线控制部件提出请求，总线控制部件通过BG同意请求，I/O接口通过BS发送总线忙
#### 计数器定时查询方式
- BR BG 地址线（$log_{2}$n + 2）
#### 独立请求方式
- n个BR BG
- 总线控制部件里面有排队器
### 3.5.2 总线通信控制
- 目的
  - 解决通信双方协调配合的问题
- 总线传输周期
  - 申请分配阶段 主模块申请，总线仲裁决定
  - 寻址阶段 主模块向从模块给出地址和命令
  - 传数阶段 主模块和从模块交换数据
  - 结束阶段 主模块撤销有关信息
- 总线通信的四种方式
  - 同步通信 由统一时标控制数据传输
  - 异步通信 采用应答方式，没有公共时钟标准
  - 半同步通信 同步、异步结合
  - 分离式通信 充分挖掘系统总线每个瞬间的潜力
# 4 存储器
## 4.1 概述
### 4.1.1 存储器分类
- 按照存储介质分类
  - 半导体存储器 TTL、MOS 易失
  - 磁表面存储器 磁头，载磁体 非易失
  - 磁芯存储器 硬磁材料、环状元件 非易失
  - 光盘存储器 激光、磁光材料 非易失
- 按照存取方式分类
  - 存取时间和物理地址无关（随机访问）
    - 随机存储器 在程序的执行过程中可读可写
    - 只读存储器 在程序的执行过程中只读
  - 存取时间和物理地址有关（串行访问）
    - 顺序存取存储器 磁带
    - 直接存取存储器 磁盘
- 按在计算机中的作用分类
  - 主存储器
    - RAM
      - 静态RAM
      - 动态RAM
    - ROM
      - MROM
      - PROM
      - EPROM
      - EEPROM
  - Flash Memory
  - 高速缓冲存储器（Cache）
  - 辅助存储器 磁盘、磁带、光盘
### 4.1.2 存储器的层次结构
- 存储器三个主要特性的关系
  - 速度 容量 价格/位
  - 寄存器 缓存 主存 磁盘 光盘 磁带
  - 速度从快到慢 容量从小到大 价格从低到高
- 缓存-主存层次和主存-辅存层次
  - cpu 10ns 缓存 20ns 主存 200ns 辅存 ms
## 4.2 主存储器
### 4.2.1 概述
### 4.2.1 主存的基本组成
- MAR
- 译码器
- 驱动器
- 存储体
- 读写电路 控制电路
- MDR
### 4.2.2 主存与CPU之间的联系
### 4.2.3 主存中存储单元地址的分配
- 大端、大尾方式
  - 高位字节地址为字地址
- 小端、小尾方式
  - 低位字节地址为字地址
- 设地址线24根 按字节寻址 $2^{24}=16MB$
- 若字长为16位 按字寻址 8MW
- 若字长为32位 按字寻址 4MW
### 4.2.4 主存的技术指标
- 存放容量 主存存放二进制代码的总位数
- 存储速度
  - 存取时间 存储器的访问时间
    - 读出时间 写入时间
  - 存取周期 连续两次独立的存储器操作
    - (读或写)所需的最小间隔时间
    - 读周期 写周期
- 存储器的带宽 位/秒
### 4.2.2 半导体存储芯片简介
- 半导体存储芯片的基本结构
  - 译码驱动
  - 存储矩阵
  - 读写电路
  - 地址线
    - 单向
  - 数据线
    - 双向
  - 片选线
    - CS
    - CE
  - 读写控制线
    - WE 低电平写 高电平读
    - OE 允许读 WE允许写
- 半导体存储芯片的译码驱动方式
  - 线选法
  - 重合法
### 4.2.3 随机存取存储器(RAM)
- 静态RAM(SRAM)
  - 保存0和1的原理是什么
  - 基本单元电路的构成是什么
  - 对单元电路如何读出和写入
  - 典型芯片的结构是什么样子的
  - 静态RAM芯片如何读出和写入
- 动态RAM(DRAM)
- 动态RAM和静态RAM的比较
- 动态RAM刷新
  - 集中刷新(存取周期为0.5us)
  - 分散刷新(存取周期为1us)
  - 分散式刷新与集中刷新相结合(异步刷新)
- 动态RAM和静态RAM的比较
  - 存储原理
    - 电容
    - 触发器
  - 集成度
    - 高
    - 低
  - 芯片引脚
    - 少
    - 多
  - 功耗
    - 小
    - 大
  - 价格
    - 低
    - 高
  - 速度
    - 慢
    - 快
  - 刷新
    - 有
    - 无
### 4.2.4 只读存储器(ROM)
- 早期的只读存储器--在厂家就写好了内容
- 改进1--用户可以自己写--一次性
- 改进2--可以多次写--要能够对信息进行擦除
- 改进3--电可擦写--特定设备
- 改进4--电可擦写--直接连接到计算机

1. 掩模ROM(MORM)
2. PROM(一次性编程)
3. EPROM(多次性编程)
4. EEPROM(多次性编程)
   - 电可擦写
   - 局部擦写
   - 全部擦写
5. Flash Memory(闪存型存储器)
### 4.2.5 存储器与CPU的连接
存储器容量的扩展
- 位扩展
  - 增加存储字长
- 字扩展(增加存储字的数量)
- 字、位同时扩展
  
存储器与CPU的连接
- 地址线的连接 
- 数据线的连接
- 读/写命令线的连接
- 片选线的连接
- 合理选择存储芯片
- 其他 时序、负载
### 4.2.6 存储器的校验
- 合法代码集合
  - {000, 001, 010, 011, 100, 101, 110, 111} 检0位错、纠0位错
  - {000. 011, 101, 110} 检1位错、纠0位错
  - {000, 111} 检1位错、纠1位错
  - {0000, 1111} 检2位错，纠1位错
  - {00000, 11111} 检2位错，纠2位错

编码的最小距离
- 任意两组合法代码之间二进制位数的最少差异
- 编码的纠错、检错能力与编码的最小距离有关
  - L-1=D+C
  - L 编码的最小距离 L=3
  - D 检测错误的位数 具有一位的纠错能力
  - C 纠正错误的位数
- 汉明码是具有一位纠错能力的编码

汉明码的组成
- 汉明码采用奇偶校验
- 汉明码采用分组校验
- 汉明码的分组是一种非划分方式
### 4.2.7 提高访存速度的措施
- 采用高速器件
- 采用层次结构 Cache-主存
- 调整主存结构
## 4.3 高速缓冲存储器
### 4.3.1. 概述
- 为什么用Cache
- Cache的工作原理
  - 主存和缓存的编址
  - 命中与未命中
  - Cache的命中率
  - Cache-主存系统的效率
- Cache的基本结构
- Cache的读写操作
- Cache的改进
### 4.2.2 Cache-主存的地址映射
### 4.2.3 替换算法